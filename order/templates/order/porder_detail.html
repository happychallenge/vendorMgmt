{% extends "base.html" %}
{% load static bootstrap3 %}

{% block title %}
    ORDER DETAIL
{% endblock title %}

{% block css %}
    <link href="{% static 'css/iCheck/custom.css' %}" rel="stylesheet">
    <link href="{% static 'css/dataTables/datatables.min.css' %}" rel="stylesheet">
{% endblock css %}


{% block header-index %}
    <h2> PURCHASE ORDER </h2>
    <ol class="breadcrumb">
        <li>
            <a href="{% url 'home' %}">Home</a>  
        </li>
        <li>
            <a href="{% url 'order:porder_list' %}"> 
                PURCHASE ORDER
            </a>
        </li>
        <li class="active">
            <strong>PURCHASE ORDER DETAIL</strong>
        </li>
    </ol>
{% endblock header-index %}


{% block mainContent %}
    <div class="col-lg-12">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5>PURCHASE ORDER DETAIL </h5>
                <div class="ibox-tools">

                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-wrench"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="#">Config option 1</a></li>
                    </ul>
                </div>
            </div>

            <div class="ibox-content"> 
                <table class="table table-striped table-bordered table-hover" >
                    <thead>
                        <tr>
                            <th style='width:20%'>ITEM</th>
                            <th>CONTENT</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="gradeX">
                            <td>OFFER #</td>
                            <td>{{ porder.offer_no }}</td>
                        </tr>
                        <tr class="gradeX">
                            <td>NAME</td>
                            <td>{{ porder.name }}</td>
                        </tr>
                        <tr class="gradeX">
                            <td>VENDOR</td>
                            <td>{{ porder.vendor }}</td>
                        </tr>
                        <tr class="gradeX">
                            <td>CONTACT</td>
                            <td>{{ porder.contact }}</td>
                        </tr>
                        <tr class="gradeX">
                            <td>TOTAL AMOUNT</td>
                            <td>{{ porder.total_amount }}</td>
                        </tr>
                        <tr class="gradeX">
                            <td>PRICE TERM</td>
                            <td>{{ porder.paycondition.price_term }}</td>
                        </tr>
                        <tr class="gradeX">
                            <td>PAY PERIOD</td>
                            <td>{{ porder.paycondition.pay_term }}</td>
                        </tr>
                        <tr class="gradeX">
                            <td>CONFIRMED</td>
                            <td>{{ porder.confirmed }}</td>
                        </tr>
                        <tr class="gradeX">
                            <td>FIXED</td>
                            <td>{{ porder.fixed }}</td>
                        </tr>
                        <tr class="gradeX">
                            <td>PAID</td>
                            <td>{{ porder.paid }}</td>
                        </tr>
                        <tr class="gradeX">
                            <td>CONTRACT FILE</td>
                            <td>{{ porder.sales_file }}</td>
                        </tr>
                    {% if user.is_superuser %}
                        <tr class="gradeX">
                            <td>PURCHASE FILE</td>
                            <td>{{ porder.purchase_file }}</td>
                        </tr>
                    {% endif %}
                    {# PORDER ITEM #}
                        <tr class="gradeX">
                            <td colspan="2">
                                <h3>ORDER ITEM</h3>
                                <table class="table table-striped table-bordered ">
                                    <thead>
                                        <tr>
                                            <th>PRODUCT</th>
                                            <th>P TYPE</th>
                                            <th>AMOUNT</th>
                                            <th>UNIT PRICE</th>
                                            <th>PURCHASE PRICE</th>
                                            <th>PACKING</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                {% for porderitem in porder.porderitem_set.all %}
                                    <tr>
                                        <td> {{porderitem.product}} </td>
                                        <td> {{porderitem.ptype}} </td>
                                        <td style='text-align:right'> {{porderitem.amount|floatformat:2}} </td>
                                        <td style='text-align:right'> $ {{porderitem.unit_price|floatformat:2}} </td>
                                        <td style='text-align:right'> $ {{porderitem.purchase_price|floatformat:2}} </td>
                                        <td> 
                                            {{porderitem.packing.unit_weight}} Kg
                                            {{porderitem.packing.packing_type}}
                                            {{porderitem.packing.pallet_weight}} Kg per Pallet
                                        </td>
                                    </tr>                            
                                {% endfor %}
                                    </tbody>
                                </table>
                            </td>
                        </tr>

                        <tr class="gradeX">
                            <td colspan="2">
                                <h3>SHIPPING ITEM</h3>
                                <table class="table table-striped table-bordered ">
                                    <thead>
                                        <tr>
                                            <th>DESTINATION</th>
                                            <th>SHIPPING DATE</th>
                                            <th>COMMENT</th>
                                            <th>ACTION</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                            {% for shipping in porder.shipping_set.all %}
                                    <tr>
                                        <td> {{shipping.destination}} </td>
                                        <td> {{shipping.shipping_date}} </td>
                                        <td width='40%'> {{shipping.comments|linebreaks}} </td>
                                        <td> 
                                            <button class="btn btn-primary createMaterial" data-url="{% url 'order:material_file' %}?shipping={{shipping.id}}">APPEND FILE</button> 
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan='4' id='htmlMaterial'>
                                        </td>
                                    </tr>
                                {% if shipping.material %}
                                    <tr>
                                        <td colspan='4'>
                                            <table class="table table-striped table-bordered ">
                                                <thead>
                                                    <tr>
                                                        <td>NAME</td>
                                                        <td>FILE</td>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>INVOICE</td>
                                                        <td>
                                                            <a href="{{ shipping.material.invoice.url }}">
                                                            {{ shipping.material.invoice }}
                                                            </a>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>PACKING LIST</td>
                                                        <td>
                                                            <a href="{{ shipping.material.packingList.url }}">
                                                            {{ shipping.material.packingList }}
                                                            </a>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Bill of Lading</td>
                                                        <td>
                                                            <a href="{{ shipping.material.billofLading.url }}">
                                                            {{ shipping.material.billofLading }}
                                                            </a>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Certificate of Ananlysis</td>
                                                        <td>
                                                            <a href="{{ shipping.material.coa.url }}">
                                                            {{ shipping.material.coa }}
                                                            </a>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>FTA CO</td>
                                                        <td>
                                                        {% if shipping.material.fta_co %}
                                                            <a href="{{ shipping.material.fta_co.url }}">
                                                            {{ shipping.material.fta_co }}
                                                            </a>
                                                        {% endif %}
                                                        </td>
                                                    </tr>
                                                {% if user.is_superuser %}
                                                    <tr>
                                                        <td>BAO GUAN DAN</td>
                                                        <td>
                                                            <a href="{{ shipping.material.baoguandan.url }}">
                                                            {{ shipping.material.baoguandan }}
                                                            </a>
                                                    </td>
                                                    </tr>
                                                {% endif %}
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>                                              
                                {% endif %}                    
                            {% endfor %}
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                    {% if porder.paid == False %}
                        <tr>
                            <td colspan="2">
                                <a href="{% url 'order:shipping_add' porder.id %}"> 
                                    <button class="btn btn-primary"> ADD SHIPPING </button>
                                </a>                  
                                <a href="{% url 'order:porderitem_add' porder.id %}"> 
                                    <button class="btn btn-primary pull-right">MODIFY ORDER</button>
                                </a>
                            </td>
                        </tr>
                    {% endif %}
                    </tbody>
                </table>

            </div> <!-- class="ibox-content" -->
        </div> <!-- class="ibox float-e-margins" -->
    </div> <!-- class="col-lg-12" -->
    
    <div class="modal fade" id="modalMaterial">
        <div class="modal-dialog">
            <div class="modalContent">
                
            </div>
        </div>
    </div>    
{% endblock mainContent %}



{% block javascript %}
<script>
$(function(){
    var loadForm = function(){
        var btn = $(this);
        $.ajax({
            url: btn.attr('data-url'),
            type: 'GET',
            dataType: 'html',
            beforeSend: function(){
                $('#modalMaterial').modal('show');
            },
            success: function(data){
                $('#addMaterial .modalContent').html(html);
            }
        });
    };

    var saveForm = function(){
        var form = $(this);
        $.ajax({
            url: form.attr('action'),
            data: from.serialize(),
            type: 'html',
            success: function(data){
                $('#htmlMaterial').html(html);
                $('#modalMaterial').modal('hide');
            }
        });
        return false;
    };

    $('.createMaterial').click(loadForm);
    $('#modalMaterial .modalContent').on('submit', '#file_form', saveForm);
});
</script>
{% endblock javascript %}

</body>

</html>
